游走在东欧和中亚的奇幻熊

APT-C-20,又被称为（APT28, Fancy Bear, Pawn Storm, Sofacy Group, Sednit, STIONTIUM等），是一个具有军方情报机构背景的APT组织。该组织最早的攻击活动可以追溯到2004年至2007年之间。主要攻击目标为北美和欧洲的政府机构、外交机构、科研机构等。

360高级威胁研究院监测发现近期APT28组织攻击活动处于活跃状态，同时国外安全研究人员在推特上分享了大量疑似APT28组织的攻击样本。在结合360安全大脑威胁情报数据进行分析后，我们追踪发掘了近期APT28组织攻击活动的全部脉络，确认近期APT28组织的攻击是针对中亚地区相关机构进行的一系列攻击活动。

攻击活动分析
根据360安全大脑的关联分析，我们发现攻击者的初始攻击是通过投递恶意附件进行，恶意附件中含有APT28组织的专属下载器Zebrocy，APT28组织在过往多年的APT攻击行动中都频频使用了Zebrocy。
在360安全大脑的监测范围内，我们发现APT28组织在2020年5月期间共发起了三次攻击活动，攻击目标为中亚地区的相关机构。
三次攻击活动相关的恶意附件信息如下：
cd0aa9b954010b704f741debf46ade5e the-chief-of-the-sanitary-inspection-armed-forces-for-movement-of-allied-military-personnel-in-the-territory.rar
e9bf5ce92b9d286fdc66616ca2cc5c68 gai-18.rar
1ce718ba64b85b58a3dfbd3a7b207990 ucx.no.-745_14-05-2020.rar
82e0597f56653a8788bfb531af460eb0 national_drug_report_2020[7294].rar
88ce694a89cc1d381818a61d9494ba58 DN-098-2020_MFA.rar
其中在2020年5月14号的攻击活动中，APT28组织所使用的一个诱饵文件与波兰的弗罗茨瓦夫市所属军事预防医学中心近期公开发布的一条军事公告相关，该公告涉及波兰军队卫生官员就新冠疫情对波兰边境军队活动的指示。
由于攻击活动关联了波兰的军事活动，我们综合所有的威胁情报数据进行分析，梳理了此时间段所有波兰的重要军事事件，形成了攻击时间线。
我们发现在2020年6月12日CNN报道了波兰与捷克发生的边境摩擦事件，东欧、中亚等周边国家局势开始变得紧张。对应攻击时间线可以发现此次APT攻击活动发动的前后时期，波兰边境正在酝酿着冲突摩擦。现实世界的地区军事局势似乎与网络空间中的攻击趋势存在着一定的巧合，APT攻击往往伴随在现实世界重大政治、外交活动或军事冲突的发生前夕和过程中。

关于Zebrocy
APT28 在历史的攻击活动中多次使用 Zebrocy Downloader 。 Zebrocy Downloader 包括 delphi版本，nim版本，Autolt版本，VB.NET版本，Visual C++版本，C#版本以及go版本。Zebrocy Downloader主要功能为收集目标计算机的信息，在目标被确认后，植入下一阶段攻击组件。
Zebrocy Downloader通常使用两种方式进行攻击：
1. 作为初始攻击释放的荷载，初始攻击通常为漏洞文档，漏洞文档会释放执行Zebrocy Downloader。
2. 作为初始攻击的诱饵文件，这类攻击通常以钓鱼邮件的恶意附件出现，附件多数情况下为压缩包。压缩包会包含Zebrocy Downloader和诱饵文档两个文件，通常两个文件都会出现破损文件的提示信息误导用户点击执行。在少数情况附件只单独携带Zebrocy Downloader。2019年针对中亚某外交机构的攻击活动中，APT28所使用的诱饵附件内容如下。
不管Zebrocy Downloader使用了什么开发语言进行开发，其目的都较为直接，主要用于信息收集和下一阶段的攻击组件部署。到目前发现的Zebrocy Downloader中，主要功能有：
1. 信息收集，Zebrocy Downloader主要会收集如下的信息:获取目标计算机的截图。获取Windows版本。获取已安装软件的列表。获取硬盘信息。
2. 利用cmd.exe执行命令。
3. 植入下一阶段攻击组件，Zebrocy Downloader主要植入过如下的攻击组件：Xagent Backdoor、Delphi Backdoor、Golang Backdoor。

攻击样本分析
我们梳理了APT28组织此次攻击活动的技战术流程。
我们对APT28组织近期的第一次攻击活动使用的恶意附件DN-098-2020_MFA.rar进行分析，可以看到恶意文件的修改时间为2020年5月14号。
DN-098-2020_MFA(1).exe为APT28组织的Delphi类Zebrocy Downloader，Scan_Letters.docx为损坏的Word文档。
当用户误打开恶意附件中的Zebrocy Downloader后，Downloader将复制自身到C:\Users\user\AppData\Roaming\Tools\[\dA-F]{8}\sqlclient.sys，然后调用WinExec传入/s参数执行。
同时Zebrocy Downloader将显示伪造的程序错误信息迷惑用户。
sqlclient.sys再次启动之后，会对用户的屏幕进行截屏，将截屏数据使用base64编码后上传至 http://185.234.52.168/categories/buildings.php
同时sqlclient.sys会持续等待C&C交互执行命令或下发下一阶段攻击组件
在获取C&C的命令执行指令后，sqlclient.sys 会调用Cmd.exe执行相应的命令，并利用管道获得执行结果。
APT28组织在对中招用户角色进行筛选之后，会下发下一阶段攻击组件，利用定时任务执行copy命令将下发的攻击组件复制到指定的文件夹，然后再执行。此动作疑似为绕过特定安全软件的检测。
在Zebrocy Downloader中，攻击者会将命令字符信息编码成16进制字符串，这也符合历史上老版本Delphi类Zebrocy Downloader的代码风格。
Zebrocy Downloader在植入攻击组件之后，会执行命令删除之前拷贝动作的计划任务，清理植入动作的痕迹。
最终，对于下一阶段的攻击取决于攻击者针对特定目标客户端筛选进行的交互操作，我们仍在持续监测中。在此我们建议相关机构使用IOC针对攻击进行自行排查。

样本关联信息
关联1：Zebrocy会将功能相关的字符信息编码成16进制，如下图为早期版本的Zebrocy Downloader将文件名和URL信息编码成16进制。
关联2：Zebrocy利用定时器回调函数中实现功能。
如下图为早期Zebrocy Downloader在定时器回调函数中调用Form.Close，主功能实现在Form.Close函数中。在本次攻击中的样本，在定时器回调函数中实现数据回传。
在近期攻击中的样本，在定时器回调函数中实现数据回传。
关联3：截图数据使用base64编码后上传至C2。
在eset披露过的Zebrocy Downloader Golang版本中，获得截图数据后，Zebrocy使用base64编码后上传至C2。

总结
2020年已经过去一半，APT组织的攻击活动仍然呈现出显著的地缘政治特点，其实施的网络威胁活动始终穿插在现实的大国政治和军事博弈过程中，网络空间威胁或已成为各国情报机构和军事行动达到其情报获取或破坏目的所依赖的重要手段之一。APT28的定向攻击活动仍在继续，相关单位需要时刻保持警惕，360高级威胁研究院对该组织的攻击将持续进行追踪。目前，360威胁情报云、APT全景雷达等360全线安全产品已经支持对该组织的攻击检测。

IOC
类别 md5
邮件附件 cd0aa9b954010b704f741debf46ade5e
e9bf5ce92b9d286fdc66616ca2cc5c68
1ce718ba64b85b58a3dfbd3a7b207990
88ce694a89cc1d381818a61d9494ba58
82e0597f56653a8788bfb531af460eb0
Downloader a31e3b8d2f5e0369be8f3dbb7e23120b
6e1effd8de77a10f315db1109c5e73e3
961952e4873d9572cc356cb2425c1552
0a00f0ff2b69df91c1b83772a0f1b160
019555014b716f3eaac3d81d122beba0
诱饵文档 ed63c42a51b711b81e9aca9a4a150bbd
C2 185.234.52.168
C2 185.221.202.36

MITRE ATT&CK 技术矩阵
Tactic ID Name Description
Initial Access T1193 Spearphishing Attachment 利用钓鱼邮件附件进行初始攻击
T1204 User Execution 诱骗用户点击执行
Execution T1106 Execution through API 调用WinExec启动自身
T1059 Command-Line Interface 利用cmd.exe执行命令
Defense Evasion T1053 Scheduled Task 利用计划任务执行命令
T1107 File Deletion 使用命令删除计划任务
T1202 Indirect Command Execution 利用计划任务间接执行copy.exe
Collection T1113 Screen Capture 收集用户屏幕截图数据
T1005 Data from Local System 收集系统信息数据
Command and Control T1071 Standard Application Layer Protocol 使用http协议通信
Exfiltration T1132 Data Encoding 对数据进行编码传输

[1] https://womp-wroclaw.wp.mil.pl/en/articlesnews-v/movement-of-allied-military-personnel/
[2] https://www.welivesecurity.com/2019/09/24/no-summer-vacations-zebrocy/