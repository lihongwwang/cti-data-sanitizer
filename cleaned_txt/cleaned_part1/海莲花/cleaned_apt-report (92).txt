【微步报告】"海莲花"团伙本月利用Office漏洞发起高频攻击

微步情报局 2018-05-16 10:26:01

TAG APT32 Denis CVE­2017­11882 CVE­2017­8570

TLP

2018­04­27

“海莲花” APT32 OceanLotus 2012
“APT32”

“攻击样本” “诱饵文档” “漏洞利用” Denis “宏” macOS 2018

4 Office Denis

APT32

2018 4 APT32 CVE­2017­11882 CVE­2017­8570 Office Denis
“漏洞利用文档”

APT32 2018 4 5 info club xyz

IP 59 IOC
TDP API

100 APT32
APT32

CVE 2017 11882 CVE 2017 8570 Denis

CVE­2017­11882 CVE­2017­8570 Denis

SHA256 C2
e5c766ad580b5bc5f74acc8 CVE­2017­11882 straliaenollma.xyz andreaga Document_GPI Invitation­U
d2f5dd028c11495d2ce503d huvrauvin.com byronorenst NSOOC China.doc
e7c7a294f94583849d ein.com

0d1577802d4560b9ba184a CVE­2017­11882 stopherau.com orinneamou
2d13570ba28ed0318eee52 re.com ochefort.com
0f2f7a6c5ef238671dd9

3a3bc31afcf2ec82ff9ac001 CVE­2017­8570 tsworthoa.com earlase.com
6ce47e10833227665ab056 aximilian.com
117520bdf097525c63

abfcba26e50a88c2ce50721 CVE­2017­8570 orinneamoure.com ochefor Monthly Report 03.2018.doc
2b15d2ee24c28fc8b28edea t.com icmannaws.com
ae27f70faaf6fae700

Denis APT32 DNS C2
Denis Word Excel WPS PDF Adobe FireFox Google

“Document_GPIInvitation­UNSOOC China.doc” CVE­2017­11882
APT32 Denis

1

rtf
3139367

Document_GPI Invitation­UNSOOC China.doc

SHA256 e5c766ad580b5bc5f74acc8d2f5dd028c11495d2ce503de7c7a294f94583849d

SHA1 e2d949cf06842b5f7ae6b2dffaa49771a93a00d9

MD5 02ae075da4fb2a6d38ce06f8f40e397e

3 CVE­2017­11882

4 CVE­2017­11882 “样本”

shellcode1 shellcode1 shellcode2 shellcode2 C:\ Program Files\ Microsoft­Windows­DiskDiagnosticResolver_2021325962
MicrosoftWindowsDiskDiagnosticResolver.exe rastls.dll OUTLFLTR.DAT MicrosoftWindowsDiskDiagnosticResolver.exe MicrosoftWindowsDiskDiagnosticResolver.exe Symantec

rastls.dll “RAS TLS” rastls.dll APT32 Denis “DNS隧道” Denis “Denis家族” Denis

APT32

x.threatbook.cn straliaenollma.xyz andreagahuvrauvin.com byronorenstein.com

C2 APT32

C2
straliaenollma.xyz 2018/04/06­2019/04/06

andreagahuvrauvin.com 2018/04/06­2019/04/06

byronorenstein.com 2018/04/06­2019/04/06

x.threatbook.cn CVE2017­11882 C2 stopherau.com

APT32 2018/04/04­2018/04/06 C2 TLD club xyz info IOC APT32

CVE­2017­11882 Office

1) Office
ollydbg

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WindowsNT\CurrentVersion\Image File Execution Options\EQNEDT32.exe

2) ollydbg 0x00411655 0x00411655
ollydbg

3) ollydbg F9

F9 EDI ESI

EDI

12F250 4115D8

0012F250 00402114

4) 00402114 00402114 0012f3D0

a) kernel32 API API

kernel32.GetModuleHandleW
kernel32.LoadLibraryW
kernel32.GetProcAddress
kernel32.CreateFileW
kernel32.SetFilePointer
kernel32.ReadFile
kernel32.WriteFile
kernel32.CloseHandle
kernel32.ExpandEnvironmentStringsW
kernel32.VirtualAlloc kernel32.VirtualFree
kernel32.CreateThread
kernel32.WaitForSingleObject kernel32.CopyFileW
kernel32.OpenProcess
kernel32.GetCurrentProcessId
kernel32.CreateToolhelp32Snapshot
kernel32.Process32FirstW
kernel32.Process32NextW
kernel32.GetFileSize
Kernel32.CreateFileMappingW
kernel32.MapViewOfFile
kernel32.GetLogicalDriveStringsW
kernel32.QueryDosDeviceW
kernel32.GetTempPathW
kernel32.OutputDebugStringW
kernel32.Sleep

b) kernel32.GetProcAddress ntdll

ntdll.ZwQuerySystemInformation
ntdll.ZwDuplicateObject
ntdll.ZwQueryObject

c) ole32.dll ole32.CoInitialize ole32.CoCreateInstance

d) oleaut32.VariantInit oleaut32.GetActiveObject

e) psapi.GetMappedFileNameW

5) winword winword shellcode

a) CreateToolhelp32Snapshot Process32FirstW Process32NextW CloseHandle winword ID

b) ZwQuerySystemInformation SystemInformationClass= SystemExtendedHandleInformation ZwQueryObject winword CreateFileMappingW MapViewOfFile “yyyy” VirtualAlloc

6) shellcode PE

shellcode DLL DLL DllMain
DLL DllEntry DLL c:\ Program Files\ Microsoft­Windows­DiskDiagnosticResolver_2021325962
MicrosoftWindowsDiskDiagnosticResolver.exe rastls.dll OUTLFLTR.DAT MicrosoftWindowsDiskDiagnosticResolver.exe

威胁指标（IOC）

域名(55)
alphbbeauchemin.co 3 3 0 0 4
andreagahuvrauvin.co 5 8 0 0 9
andreagbridge.com 5 7 0 0 9
angelinachilds.com 4 6 0 0 4
audreybourgeois.com 4 4 0 0 4
aximilian.com 5 3 0 0 9
beaudrysang.xyz 3 3 0 0 4
byronorenstein.com 5 7 0 0 9
cesterlaunela.club 3 3 0 0 4
christienoll.xyz 3 5 0 0 4

Hash(4)
0d1577802d4560b9ba 1/25 0 3
3a3bc31afcf2ec82ff9a 4/25 0 2
abfcba26e50a88c2ce5 6/25 0 1
e5c766ad580b5bc5f74 7/25 0 3