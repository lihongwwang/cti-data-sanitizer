【微步在线报告】越南国家背景APT组织“海莲花”利⽤疫情话题攻击我国政府机构 - 情报详情

【微步在线报告】越南国家背景APT组织“海莲花”利⽤疫情话题攻击我国政府机构

概述

新型肺炎近期在全球范围内引起⼴泛关注，微步情报局监测发现，⾃新型肺炎爆发以来，有⼤量APT组织和⿊产团伙利⽤作为话题发起攻击，如⽩象、绿斑、蔓灵花、海莲花、Kimsuky和Hades等，微步在线已撰写了多篇相关报告披露来此类攻击活动。

“海莲花”，⼜名APT32和OceanLotus，是越南背景的⿊客组织。该组织⾄少⾃2012年开始活跃，⻓期针对中国能源相关⾏业、海事机构、海域建设部⻔、科研院所和航运企业等进⾏⽹络攻击。除中国外，“海莲花”的⽬标还包含全球的政府、军事机构和⼤型企业，以及本国的媒体、⼈权和公⺠社会等相关的组织和个⼈。

近期，微步情报局通过威胁狩猎系统再次捕获“海莲花”利⽤疫情话题针对我国发起攻击活动的样本⽂件，分析有如下发现：

· 攻击者以“湖南省家禽H5N1亚型⾼致病性禽流感疫情情况”、“冠状病毒实时更新：中国正在追踪来⾃湖北的旅⾏者”等时事热点为诱饵进⾏⻥叉攻击，攻击活动或发⽣于今年2⽉。

· 攻击者利⽤带数字签名的WPS⽂件，通过社会⼯程学诱导受害者点击执⾏，运⾏以后会通过侧加载⽅式装载恶意DLL，释放诱饵⽂档并且在内存中加载DenesRAT⽊⻢。

· DenesRAT⽊⻢具备⽂件操作、注册表读写、设置环境变量和远程执⾏代码等功能的后⻔，该后⻔被插⼊⼤量花指令⽤于对抗分析。

· 通过C2域名关联发现，“海莲花”此次攻击活动的⽬标或涉及我国某部委及武汉市多家政府机构，性质极为恶劣。

·微步在线通过对相关样本、IP和域名的溯源分析，共提取5条相关IOC，可⽤于威胁情报检测。微步在线的威胁情报平台（TIP）、威胁检测平台（TDP）、API等均已⽀持此次攻击事件和团伙的检测。

详情

⾃活跃以来，“海莲花”⼀直持续针对我国进⾏⽹络攻击。在攻击过程中，“海莲花”⼀直在尝试不同⽅法以实现在⽬标系统上执⾏恶意代码和绕过安全检测，其中经常使⽤的包含⽩利⽤和C2流量伪装等。⽩利⽤和压缩⽂件结合是“海莲花”惯⽤的⽊⻢投递⼿法。

近⽇，微步情报局再次捕获到多个“海莲花”利⽤合法WPS可执⾏程序加载恶意DLL针对我国等⽬标的攻击样本。

诱饵⼀：湖南省家禽H5N1亚型⾼致病性禽流感疫情情况.docx

诱饵⼆：冠状病毒实时更新：中国正在追踪来⾃湖北的旅⾏者.doc

相关攻击的整体攻击流程如下：

由于诱饵⽂档相关内容均出现于今年2⽉上旬，据此推断攻击活动或发⽣在2⽉期间。

样本分析

攻击者通过带数字签名的WPS⽂件侧加载恶意DLL krpt.dll，krpt.dll执⾏后会解压DLL携带的资源⽂件并释放出诱饵⽂档，同时在内存中构造出后⻔DLL数据，然后修复导⼊表和重定位表。接着调⽤这个DLL的DllMain函数完成初始化，最后调⽤这个DLL的导出函数DllEntry执⾏后⻔功能。

由于投递的两个样本代码和C2基本完全⼀致，下⽂以其中⼀个为例进⾏分析。

1、 基本信息如下：

恶意⽂件名称 krpt.dll
SHA256 c0d295d414ccd0b84a0e6c9f8c42083355a92ba97182d3aed9d5e8a99e3a99b1

SHA1 5ba69be6ff537224fcc1cd1090ffd0303af69d88

MD5 c8ea645fc5ac975af53e568566b90131

样本⼤⼩ 1.17 MB (1,230,848 字节)

样本格式 DLL

2、 侧加载⽅式装载“krpt.dll”⽂件并调⽤“_force_link_krpt”导出函数，然后将DLL携带的诱导⽂档资源释放到“%TEMP%”⽬录，相关代码：

3、 释放完诱导⽂档后，加载资源⽂件中的Shellcode代码，相关代码：

4、 Shellcode头部为循环解密代码，相关代码：

5、 接着会获取HTTP接⼝函数，获取计算机名和⽤户名，通过HTTP⽅式提交到“libjs.inquirerjs.com"/script/x.png?CN=计算机名称&UN=⽤户名称&C=Windows_N”，如下图：

6、 执⾏完HTTP请求后，跳转到插⼊⼤量“海莲花”常⽤花指令的Shellcode，最终在内存中加载DenesRAT后⻔，截图为DLL功能⼊⼝：

7、 解密后的DenesRAT的C2配置为“vitlescaux.com”，如下：

8、 然后连接C2：“vitlescaux.com:28194”，通过TCP协议发送加密后的数据到C2服务器，相关截图：

9、 最终释放的DenesRAT为“海莲花”组织私有⽊⻢，能够根据C2服务器下发的指令执⾏相应的功能，主要功能有：

• ⽂件操作，⽐如创建⽂件或⽬录、删除⽂件或⽬录、查找⽂件；

• 注册表读写；

• 远程执⾏代码，⽐如创建进程、执⾏DLL等；

• 设置环境变量。

关联分析

综合分析此次攻击的背景、TTPs、以及所使⽤的⽊⻢和⽹络资产，确定幕后攻击者为“海莲花”。

对libjs.inquirerjs.com进⾏关联分析发现，该域名曾在之前“海莲花”的攻击中被使⽤。

此外，该域名近期还出现了多个可疑URL地址，涉及x****c@china*****.gov.cn 、wu****zs@wuhan.gov.cn、y****c@126.com等邮箱地址。根据微步情报局对“海莲花”历史活动的分析，这些URL应是被⽤于对⽬标邮箱的探测⾏为。⽽相关邮箱分别属于我国某部委及武汉市多家政府机构，暴露出“海莲花”此次攻击活动的险恶⽤⼼。

威胁指标（IOC）
域名(2)
libjs.inquirerjs.com
vitlescaux.com
Hash(2)
36be872b74680305cb6
c0d295d414ccd0b84a0
URL(1)
libjs.inquirerjs.com"/script/x.png?CN=%计算机名称%&amp;UN=%…